<!doctype html>
<html>
<meta charset=utf-8>
<meta http-equiv=X-UA-Compatible content=IE=Edge>
<title>中华铁路工具箱</title>
<link href="//code.jquery.com/ui/1.11.2/themes/ui-lightness/jquery-ui.css" media="screen" rel="stylesheet">
<link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-beta.3/css/select2.min.css" rel="stylesheet" />
<!-- https://raw.githubusercontent.com/t0m/select2-bootstrap-css/bootstrap3/select2-bootstrap.min.css -->
<link href="select2-bootstrap.min.css" rel="stylesheet" />
<link href="toolkit.css" media="screen" rel="stylesheet">
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="//code.jquery.com/ui/1.11.2/jquery-ui.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/json2/20140204/json2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-beta.3/js/select2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.0/handlebars.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/randomcolor/0.1.1/randomColor.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="d3pie.min.js"></script>
<script src="/cloud.js"></script>
<script src="toolkit.js"></script>
<div class=container>
	<div class=panel-group id=main-accordion role=tablist aria-multiselectable=true>
		<div class="panel panel-default">
			<div class=panel-heading role=tab id=trains-heading>
				<h2 class=panel-title>
					<a class=collapsed data-toggle=collapse data-parent=#mainAccordion href=#trains aria-expanded=false aria-controls=trains>火车</a>
				</h2>
			</div>
			<div id=trains class="panel-collapse" role=tabpanel aria-labelledby=trains-heading>
				<div class=panel-body>
					<div id=trains-container>
						<script id=train-template type=text/x-handlebars-template>
							<div id="train-{{id}}" class="train-row" data-id="{{id}}">
								<div class=row>
									<div class=col-md-12>
										<p><select class="train-select form-control">
											<option value=-1>自定义1星级火车
											<option value=-2>自定义2星级火车
											<option value=-3>自定义3星级火车
										</select>
									</div>
								</div>
								<div class=row>
									<div class=col-md-2>
										<p><img class="train-img img-responsive" src="" alt="">
									</div>
									<div class=col-md-10>
										<p><span class=train-info></span> |
										<button type=button class="btn btn-xs train-duplicate">
											<span class="glyphicon glyphicon-repeat" aria-hidden="true"></span> 复制
										</button> |
										<button type=button class="btn btn-danger btn-xs train-delete">
											<span class="glyphicon glyphicon-remove" aria-hidden="true"></span> 移除
										</button>
										<p class=train-price>
										<p class=train-desc>
									</div>
								</div>
								<div class=row>
									<div class=col-md-12>
										<table class=table>
											<tr>
												<td>&nbsp;
												<th>速度
												<th>距离
												<th>重量
												<th>电量
											<tr>
												<th>初始值
												<td><input type=number min=0 value=0 size=5 class="train-attrib train-attrib-initial train-attrib-speed" data-attrib=speed>
												<td><input type=number min=0 value=0 size=5 class="train-attrib train-attrib-initial train-attrib-distance" data-attrib=distance>
												<td><input type=number min=0 value=0 size=5 class="train-attrib train-attrib-initial train-attrib-weight" data-attrib=weight>
												<td><input type=number min=0 value=0 size=5 class="train-attrib train-attrib-initial train-attrib-battery" data-attrib=battery>
											<tr>
												<th>等级
												<td><input type=number min=1 max=100 value=1 size=3 class="train-attrib train-attrib-level train-attrib-speed form-control" data-attrib=speed>
												<td><input type=number min=1 max=100 value=1 size=3 class="train-attrib train-attrib-level train-attrib-distance form-control" data-attrib=distance>
												<td><input type=number min=1 max=100 value=1 size=3 class="train-attrib train-attrib-level train-attrib-weight form-control" data-attrib=weight>
												<td><input type=number min=1 max=100 value=1 size=3 class="train-attrib train-attrib-level train-attrib-battery form-control" data-attrib=battery>
											<tr>
												<th>改进值
												<td><input type=number min=0 size=5 class="train-attrib train-attrib-value train-attrib-speed train-attrib-ro" readonly data-attrib=speed>
												<td><input type=number min=0 size=5 class="train-attrib train-attrib-value train-attrib-distance train-attrib-ro" readonly data-attrib=distance>
												<td><input type=number min=0 size=5 class="train-attrib train-attrib-value train-attrib-weight train-attrib-ro" readonly data-attrib=weight>
												<td><input type=number min=0 size=5 class="train-attrib train-attrib-value train-attrib-battery train-attrib-ro" readonly data-attrib=battery>
										</table>
									</div>
								</div>
								<hr>
							</div>
						</script>
					</div>
					<button type=button id=trains-new class="btn btn-primary btn-block" disabled>新增</button>
				</div>
			</div>
		</div>
		<div class="panel panel-default">
			<div class=panel-heading role=tab id=stations-heading>
				<h2 class=panel-title>
					<a class=collapsed data-toggle=collapse data-parent=#mainAccordion href=#stations aria-expanded=false aria-controls=stations>车站</a>
				</h2>
			</div>
			<div id=stations class="panel-collapse" role=tabpanel aria-labelledby=stations-heading>
				<div class=panel-body>
					<p>只有列表中的车站会参与行车和优化计算。可以选择已经开通的车站，或是选择愿意开通的所有车站。
					<p><span id=stations-select>加入所有：<a href=### data-stars=3>3星级车站</a>，<a href=### data-stars=2>2星级车站</a>，<a href=### data-stars=1>1星级车站</a></span>；<span id=stations-unselect>移除所有：<a href=### data-stars=3>3星级车站</a>，<a href=### data-stars=2>2星级车站</a>，<a href=### data-stars=1>1星级车站</a></span>
					<div class=row>
						<div class=col-md-12>
							<select class=form-control id=stations-picker></select>
						</div>
					</div>
					<table id=stations-table class="text-center table">
						<thead>
							<tr>
								<th class=text-center>名称
								<th class=text-center>星级
								<th class=text-center>X
								<th class=text-center>Y
								<th class=text-center>人口
								<th>&nbsp;
						</thead>
						<tbody>
							<script id=station-template type=text/x-handlebars-template>
								<tr title="{{desc}}&#10;&#10;下辖：{{admin}}"
									id="station-{{id}}" class="station-row stars-{{stars}}" data-id="{{id}}"
								>
									<td>{{name}}
									<td>{{#each starArray}}<span class="glyphicon glyphicon-star" aria-hidden=true></span>{{/each}} {{stars}}星
									<td>{{X}}
									<td>{{Y}}
									<td>{{pop}}
									<td><button type=button class="btn btn-danger btn-xs station-delete">
										<span class="glyphicon glyphicon-remove" aria-hidden="true"></span> 移除
									</button>
							</script>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div class="panel panel-default">
			<div class=panel-heading role=tab id=route-heading>
				<h2 class=panel-title>
					<a class=collapsed data-toggle=collapse data-parent=#mainAccordion href=#route aria-expanded=false aria-controls=route>行车</a>
				</h2>
			</div>
			<div id=route class="panel-collapse" role=tabpanel aria-labelledby=route-heading>
				<div class=panel-body>
					<form class=form-horizontal role=form>
						<div class=form-group>
							<div class=col-md-6>
								<ul id=route-stations class=route-station-list>
									<li><strong>所有可用车站：</strong>
								</ul>
							</div>
							<div class=col-md-6>
								<ul id=route-waypoints class=route-station-list>
									<li><strong>发到站和路径点：</strong>
								</ul>
							</div>
						</div>
						<div class=form-group>
							<label class="col-md-2 control-label" for=route-train>使用火车：</label>
							<div class=col-md-10>
								<select class="form-control train-list-select" id=route-train multiple data-negative=true>
								</select>
							</div>
						</div>
						<div class=form-group>
							<div class="col-md-10 col-md-offset-2 checkbox">
								<label>
									<input type=checkbox id=route-insert checked> 计算时加入中转站
								</label>
							</div>
						</div>
						<div class=form-group id=route-penalty-group>
							<label class="col-md-2 control-label" for=route-penalty>中转罚分（里程）：</label>
							<div class=col-md-10>
								<input class=form-control type=number min=0 value=1 id=route-penalty>
							</div>
						</div>
						<div class=form-group>
							<div class=col-md-12>
								<button type=button id=route-calculate class="btn btn-primary btn-block" disabled>计算</button>
							</div>
						</div>
					</form>
					<div id=route-result>
					</div>
					<script id=route-alert-template type=text/x-handlebars-template>
						<div class=col-md-12>
							<div class="alert alert-{{type}} alert-dismissible" role=alert>
								<button type=button class=close data-dismiss=alert aria-label=Close>
									<span aria-hidden=true>&times;</span>
								</button>
								{{message}}
							</div>
						</div>
					</script>
					<script id=route-result-template type=text/x-handlebars-template>
						<div class=col-md-12>
							<h4>径路信息</h4>
							<dl class=dl-horizontal>
								<dt>径路
								<dd>{{#if path}}
									{{path}} |
									<button type=button class="btn btn-xs route-path-transfer">
										<span class="glyphicon glyphicon-transfer" aria-hidden=true></span> 设置为输入
									</button>
								{{else}}
									没有指定足够的车站，以此车可以行驶的最长里程计算
								{{/if}}
								<dt>总里程
								<dd>{{totalDistance}}
							</dl>
							<h4>行车信息</h4>
							<dl class=dl-horizontal>
								<dt>行车时间
								<dd>{{runningHours}}时{{runningMinutes}}分{{runningSeconds}}秒
								<dt>电量消耗
								<dd>{{batteryConsumed}}
							</dl>
							<h4>客货信息</h4>
							<dl class=dl-horizontal>
								<dt>计价里程
								<dd>{{priceDistance}}
								<dt>单位客货收入
								<dd>{{priceCoins}}金币 或 {{pricePoints}}点卷
							</dl>
							<h4>收入信息</h4>
							<dl class=dl-horizontal>
								<dt>运输成本
								<dd>{{costCoins}}金币
								{{#if hasLoads}}
									<dt>满载金币收入
									<dd>{{totalGross}}金币
									<dt>满载金币利润
									<dd>{{totalNet}}金币
								{{/if}}
							</dl>
							{{#if path}}
								<h4>全日合计</h4>
								<dl class=dl-horizontal>
									<dt>行车次数
									<dd>{{dailyCount}}
									<dt>剩余电量
									<dd>{{dailyRemaining}}
									{{#if hasLoads}}
										<dt>总金币收入
										<dd>{{dailyGross}}金币
										<dt>总金币利润
										<dd>{{dailyNet}}金币
									{{/if}}
								</dl>
							{{/if}}
						</div>
					</script>
					<script id=route-summary-template type=text/x-handlebars-template>
						<div class=col-md-12>
							<h4>全日合计</h4>
							<dl class=dl-horizontal>
								<dt>总金币收入
								<dd>{{dailyGross}}金币
								<dt>总金币利润
								<dd>{{dailyNet}}金币
							</dl>
						</div>
					</script>
				</div>
			</div>
		</div>
		<div class="panel panel-default">
			<div class=panel-heading role=tab id=optimization-heading>
				<h2 class=panel-title>
					<a class=collapsed data-toggle=collapse data-parent=#mainAccordion href=#optimization aria-expanded=false aria-controls=optimization>优化</a>
				</h2>
			</div>
			<div id=optimization class="panel-collapse" role=tabpanel aria-labelledby=optimization-heading>
				<div class=panel-body>
					<p>本功能根据指定的参数最大化以下公式的值：
					<p class=text-center>收入系数 &times; 全日总金币收入 / 基准日金币收入 + 利润系数 &times; 全日总金币利润 / 基准日利润收入 - 预期点卷消耗
					<p>由于升级成功概率难以确定，下面的概率表填入了参考值（万分比），可适当更改：
					<table id=optimization-chance-table class=table>
						<thead>
							<tr>
								<th>等级
								<th>速度
								<th>距离
								<th>重量
								<th>电量
						</thead>
						<tbody>
							<script id=optimization-chance-template type=text/x-handlebars-template>
								<tr>
									<th>{{level}}
									<td><input type=number min=1 size=10000 value="{{speed}}" class="optimization-chance optimization-chance-speed optimization-chance-level{{level}} form-control">
									<td><input type=number min=1 size=10000 value="{{distance}}" class="optimization-chance optimization-chance-distance optimization-chance-level{{level}} form-control">
									<td><input type=number min=1 size=10000 value="{{weight}}" class="optimization-chance optimization-chance-weight optimization-chance-level{{level}} form-control">
									<td><input type=number min=1 size=10000 value="{{battery}}" class="optimization-chance optimization-chance-battery optimization-chance-level{{level}} form-control">
							</script>
						</tbody>
					</table>
					<form class=form-horizontal role=form>
						<div class=form-group>
							<label class="col-md-2 control-label" for=optimization-train>使用火车：</label>
							<div class=col-md-10>
								<select class="form-control train-list-select" id=optimization-train data-negative=false>
								</select>
							</div>
						</div>
						<div id=optimization-base>
						</div>
						<script id=optimization-base-template type=text/x-handlebars-template>
							<div class="col-md-offset-2 col-md-10">
								<dl class=dl-horizontal>
									<dt>基准日金币收入
									<dd>{{gross}}金币
									<dt>基准日金币利润
									<dd>{{net}}金币
								</dl>
						</script>
						<div class=form-group>
							<label class="col-md-2 control-label" for=optimization-from>始发站：</label>
							<div class=col-md-10>
								<select class="form-control station-list-select" id=optimization-from>
								</select>
							</div>
						</div>
						<div class=form-group>
							<label class="col-md-2 control-label" for=optimization-to>终到站：</label>
							<div class=col-md-10>
								<select class="form-control station-list-select" id=optimization-to>
								</select>
							</div>
						</div>
						<div class=form-group>
							<label class="col-md-2 control-label" for=optimization-factor-gross>收入系数：</label>
							<div class=col-md-10>
								<input class=form-control type=number value=400 id=optimization-factor-gross>
							</div>
						</div>
						<div class=form-group>
							<label class="col-md-2 control-label" for=optimization-factor-net>利润系数：</label>
							<div class=col-md-10>
								<input class=form-control type=number value=400 id=optimization-factor-net>
							</div>
						</div>
						<div class=form-group>
							<label class="col-md-2 control-label" for=optimization-penalty>中转罚分（里程）：</label>
							<div class=col-md-10>
								<input class=form-control type=number min=0 value=1 id=optimization-penalty>
							</div>
						</div>
						<div class=form-group>
							<label class="col-md-2 control-label" for=optimization-slider-speed>速度范围：</label>
							<div class=col-md-8>
								<div class=optimization-slider id=optimization-slider-speed></div>
							</div>
							<div class=col-md-2 id=optimization-slider-speed-values>1 - 20</div>
						</div>
						<div class=form-group>
							<label class="col-md-2 control-label" for=optimization-slider-distance>距离范围：</label>
							<div class=col-md-8>
								<div class=optimization-slider id=optimization-slider-distance></div>
							</div>
							<div class=col-md-2 id=optimization-slider-distance-values>1 - 20</div>
						</div>
						<div class=form-group>
							<label class="col-md-2 control-label" for=optimization-slider-weight>重量范围：</label>
							<div class=col-md-8>
								<div class=optimization-slider id=optimization-slider-weight></div>
							</div>
							<div class=col-md-2 id=optimization-slider-weight-values>1 - 20</div>
						</div>
						<div class=form-group>
							<label class="col-md-2 control-label" for=optimization-slider-battery>电量范围：</label>
							<div class=col-md-8>
								<div class=optimization-slider id=optimization-slider-battery></div>
							</div>
							<div class=col-md-2 id=optimization-slider-battery-values>1 - 20</div>
						</div>
						<div class=form-group>
							<div class=col-md-12>
								<button type=button id=optimization-calculate class="btn btn-primary btn-block" disabled>计算</button>
							</div>
						</div>
					</form>
					<div id=optimization-result>
					</div>
					<script id=optimization-alert-template type=text/x-handlebars-template>
						<div class=row>
							<div class=col-md-12>
								<div class="alert alert-{{type}} alert-dismissible" role=alert>
									<button type=button class=close data-dismiss=alert aria-label=Close>
										<span aria-hidden=true>&times;</span>
									</button>
									{{message}}
								</div>
							</div>
						</div>
					</script>
					<script id=optimization-result-template type=text/x-handlebars-template>
						<table class=table>
							<thead>
								<tr>
									<th>速度等级
									<th>距离等级
									<th>重量等级
									<th>电量等级
									<th>总里程
									<th>行车次数
									<th>剩余电量
									<th>日收入
									<th>收入比
									<th>日利润
									<th>利润比
									<th>预期点卷
									<th>优化值
							</thead>
							<tbody>
								{{#each data}}
								<tr title="{{this.path}}">
									<td>{{this.speedLevel}}
									<td>{{this.distanceLevel}}
									<td>{{this.weightLevel}}
									<td>{{this.batteryLevel}}
									<td>{{this.calculated.totalDistance}}
									<td>{{this.calculated.dailyCount}}
									<td>{{this.calculated.dailyRemaining}}
									<td>{{this.calculated.dailyGross}}
									<td>{{this.grossRatio}}
									<td>{{this.calculated.dailyNet}}
									<td>{{this.netRatio}}
									<td>{{this.cost}}
									<td>{{this.func}}
								{{/each}}
							</tbody>
						</table>
					</script>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55825300-4', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
